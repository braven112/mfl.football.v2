---
/**
 * LeagueSwitcher Component
 *
 * Toggle component for switching between AFL Fantasy and TheLeague.
 * Implements smart routing to navigate to the equivalent page in the other league.
 *
 * Features:
 * - Visual toggle showing both league options
 * - Active state highlighting for current league
 * - Smart routing: attempts to navigate to equivalent page, falls back to home
 * - Accessible keyboard navigation
 * - Collapsed mode support (icon-only)
 *
 * @component
 * @example
 * <LeagueSwitcher
 *   currentLeague="theleague"
 *   currentPath="/theleague/rosters"
 *   isCollapsed={false}
 * />
 */

import type { LeagueSwitcherProps } from '../../types/nav';

interface Props extends LeagueSwitcherProps {}

const {
  currentLeague,
  currentPath,
} = Astro.props;

/**
 * Get the equivalent route in the target league.
 *
 * Smart routing logic:
 * 1. Extract the page path from current URL (e.g., /theleague/rosters -> /rosters)
 * 2. Prepend the target league prefix
 * 3. Return the target league home if path is just the root
 *
 * Note: Route existence validation happens client-side via nav-config.json
 * or could be enhanced with a route map in the future.
 */
function getEquivalentRoute(path: string, targetLeague: 'theleague' | 'afl'): string {
  const targetBase = targetLeague === 'afl' ? '/afl-fantasy' : '/theleague';
  const sourceBase = targetLeague === 'afl' ? '/theleague' : '/afl-fantasy';

  // Extract the page portion after the league prefix
  let pagePath = '';
  if (path.startsWith('/theleague')) {
    pagePath = path.slice('/theleague'.length);
  } else if (path.startsWith('/afl-fantasy')) {
    pagePath = path.slice('/afl-fantasy'.length);
  }

  // If no page path or just root, return league home
  if (!pagePath || pagePath === '/') {
    return targetBase;
  }

  // Construct equivalent URL
  return `${targetBase}${pagePath}`;
}

// Calculate target URLs for both leagues
const theLeagueUrl = currentLeague === 'theleague'
  ? currentPath
  : getEquivalentRoute(currentPath, 'theleague');

const aflUrl = currentLeague === 'afl'
  ? currentPath
  : getEquivalentRoute(currentPath, 'afl');

const isTheLeagueActive = currentLeague === 'theleague';
const isAflActive = currentLeague === 'afl';
---

<nav
  class="league-switcher"
  aria-label="Switch league"
>
  <div class="league-switcher__pill">
    <a
      href={theLeagueUrl}
      class:list={['league-switcher__option', { 'league-switcher__option--active': isTheLeagueActive }]}
      aria-label={isTheLeagueActive ? 'TheLeague (current)' : 'Switch to TheLeague'}
      aria-current={isTheLeagueActive ? 'page' : undefined}
    >
      <span class="league-switcher__abbrev">TL</span>
    </a>
    <a
      href={aflUrl}
      class:list={['league-switcher__option', { 'league-switcher__option--active': isAflActive }]}
      aria-label={isAflActive ? 'AFL Fantasy (current)' : 'Switch to AFL Fantasy'}
      aria-current={isAflActive ? 'page' : undefined}
    >
      <span class="league-switcher__abbrev">AFL</span>
    </a>
  </div>
</nav>

<style>
  .league-switcher {
    display: flex;
    align-items: center;
  }

  /* Pill toggle container */
  .league-switcher__pill {
    display: flex;
    align-items: center;
    background: var(--nav-switcher-bg, #f3f4f6);
    border: 1px solid var(--nav-switcher-border, #e5e7eb);
    border-radius: 9999px;
    padding: 2px;
    gap: 2px;
  }

  /* Individual option within the pill */
  .league-switcher__option {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--nav-spacing-sm, 8px) var(--nav-spacing-md, 12px);
    border-radius: 9999px;
    text-decoration: none;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.025em;
    color: var(--nav-switcher-inactive-text, #6b7280);
    transition: var(--nav-hover-transition);
    min-width: var(--nav-touch-target-min, 44px);
    min-height: calc(var(--nav-touch-target-min, 44px) - 8px);
  }

  .league-switcher__option:hover:not(.league-switcher__option--active) {
    color: var(--nav-text, #333333);
    background: rgba(0, 0, 0, 0.05);
  }

  .league-switcher__option:focus-visible {
    outline: none;
    box-shadow: var(--nav-focus-ring, 0 0 0 2px #1c497c);
  }

  /* Active state */
  .league-switcher__option--active {
    background: var(--nav-switcher-active-bg, #1c497c);
    color: var(--nav-switcher-active-text, #ffffff);
    cursor: default;
  }

  .league-switcher__abbrev {
    line-height: 1;
  }

  /* Dark mode support */
  :global(.dark) .league-switcher__pill {
    background: var(--nav-switcher-bg);
    border-color: var(--nav-switcher-border);
  }

  :global(.dark) .league-switcher__option {
    color: var(--nav-switcher-inactive-text);
  }

  :global(.dark) .league-switcher__option:hover:not(.league-switcher__option--active) {
    color: var(--nav-text);
    background: rgba(255, 255, 255, 0.1);
  }

  :global(.dark) .league-switcher__option--active {
    background: var(--nav-switcher-active-bg);
    color: var(--nav-switcher-active-text);
  }
</style>
