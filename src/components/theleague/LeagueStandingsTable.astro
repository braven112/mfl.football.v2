---
import type { TeamStanding } from '../../types/standings';

export interface Props {
  teams: TeamStanding[];
}

const { teams } = Astro.props;

function parseWLT(wlt: string) {
  const [w, l, t] = wlt.split('-').map(Number);
  return { w, l, t };
}

function getRowColor(seed: number | undefined): string {
  if (!seed) return '';
  if (seed <= 4) return 'tier-division-winners';
  if (seed <= 7) return 'tier-wild-cards';
  if (seed <= 9) return 'tier-play-in';
  return 'tier-toilet-bowl';
}
---

<div class="league-standings-wrapper">
  <div class="table-wrapper">
    <table class="league-standings-table">
      <thead>
        <tr>
          <th class="col-seed">Seed</th>
          <th class="col-team">Team</th>
          <th class="col-record">Record</th>
          <th class="col-pct">PCT</th>
          <th class="col-pf">PF</th>
          <th class="col-pa">PA</th>
          <th class="col-pwr">PWR</th>
          <th class="col-vp">VP</th>
        </tr>
      </thead>
      <tbody>
        {teams.map((team, index) => {
          const record = parseWLT(team.divwlt);
          const rowColor = getRowColor(team.seed);

          return (
            <tr key={team.id} class={`league-row ${rowColor}`}>
              <td class="col-seed">
                <span class="seed-number">#{team.seed}</span>
              </td>
              <td class="col-team">
                <div class="team-info">
                  {team.teamBanner && (
                    <img
                      src={team.teamBanner}
                      alt={team.teamName}
                      class="team-banner"
                      title={team.teamName}
                    />
                  )}
                </div>
              </td>
              <td class="col-record">
                {record.w}-{record.l}-{record.t}
              </td>
              <td class="col-pct">
                {parseFloat(team.divpct).toFixed(3)}
              </td>
              <td class="col-pf">
                {parseFloat(team.pf).toFixed(1)}
              </td>
              <td class="col-pa">
                {parseFloat(team.pa).toFixed(1)}
              </td>
              <td class="col-pwr">
                {parseFloat(team.pwr).toFixed(1)}
              </td>
              <td class="col-vp">
                {parseInt(team.vp)}
              </td>
            </tr>
          );
        })}
      </tbody>
    </table>
  </div>
</div>

<style>
  .league-standings-wrapper {
    width: 100%;
  }

  .table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .league-standings-table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--color-bg-secondary, #f5f5f5);
  }

  thead {
    background-color: var(--primary-content-bg-color, #fff);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  th {
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--table-header-text-color, #94a3b8);
    border-bottom: 2px solid var(--color-border, #d0d0d0);
  }

  td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--color-border, #e0e0e0);
    font-size: 0.9375rem;
    color: #000;
  }

  tbody tr {
    transition: opacity 0.2s ease;
  }

  tbody tr:hover {
    opacity: 0.85;
  }

  /* Tier Color Schemes - WCAG 2.0 AA compliant with black text */

  /* Division Winners - Light Gold (Tier 1-4) */
  .tier-division-winners {
    background-color: #fef8e7;
  }

  /* Wild Cards - Light Silver (Tier 5-7) */
  .tier-wild-cards {
    background-color: #f3f3f3;
  }

  /* Play-In - No Color (Tier 8-9) */
  .tier-play-in {
    background-color: var(--color-bg-primary, #fff);
  }

  /* Toilet Bowl - Light Brown (Tier 10-16) */
  .tier-toilet-bowl {
    background-color: #f5e6d3;
  }

  /* Column Widths */
  .col-seed {
    width: 80px;
    text-align: center;
    font-weight: 600;
  }

  .col-team {
    width: auto;
    min-width: 250px;
  }

  .col-record {
    width: 110px;
    text-align: center;
  }

  .col-pct {
    width: 100px;
    text-align: center;
  }

  .col-pf,
  .col-pa {
    width: 110px;
    text-align: right;
  }

  .col-pwr {
    width: 100px;
    text-align: center;
  }

  .col-vp {
    width: 90px;
    text-align: center;
  }

  /* Team Info */
  .team-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .team-banner {
    width: 100%;
    max-width: 400px;
    height: auto;
    object-fit: contain;
  }

  .seed-number {
    font-weight: 700;
    font-size: 1rem;
    display: inline-block;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .col-team {
      min-width: 180px;
    }

    .col-pf,
    .col-pa,
    .col-pwr {
      font-size: 0.8rem;
      padding: 0.5rem;
    }

    th {
      font-size: 0.75rem;
      padding: 0.5rem;
    }

    td {
      padding: 0.5rem;
      font-size: 0.85rem;
    }

    .team-banner {
      max-width: 200px;
    }

    .seed-number {
      font-size: 0.9rem;
    }
  }
</style>
