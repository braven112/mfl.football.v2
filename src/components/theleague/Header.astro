---
interface Props {
  host?: string;
  leagueId?: string;
  year?: string | number;
  staticHost?: string;
}

const envHost = (import.meta.env.PUBLIC_MFL_HOST as string | undefined) || 'https://api.myfantasyleague.com';
const envLeagueId = (import.meta.env.PUBLIC_MFL_LEAGUE_ID as string | undefined) || '';
const envYear =
  (import.meta.env.PUBLIC_MFL_YEAR as string | undefined) || new Date().getFullYear().toString();
const envStaticHost = (import.meta.env.PUBLIC_STATIC_HOST as string | undefined) || envHost;

const normalize = (value: string) => value.replace(/\/+$/, '');

const host = normalize(Astro.props.host || envHost);
const leagueId = Astro.props.leagueId || envLeagueId;
const year = (Astro.props.year || envYear).toString();
const staticHost = normalize(Astro.props.staticHost || envStaticHost);

const leagueHome = `${host}/${year}/home/${leagueId}`;
---

<div class="container-header theleague-header">
  <div class="container">
    <div class="row">
      <div class="col left">
        <a class="league-link" href={`${staticHost}/${year}/home/${leagueId}`}>
          <div class="league_logo" id="league_logo">
            <svg
              id="Layer_1"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 415.8 442"
              aria-hidden="true"
            >
              <g class="st0">
                <path
                  class="st1"
                  d="M115.6 499l-1.4-4.2h-11.5l-1.4 4.2h-8.5l11-29.1h9.5l11 29.1h-8.7zm-7.2-21.7l-3.7 11h7.4l-3.7-11zM130 499v-22.6h-8.2v-6.5h23.8v6.5h-8.1V499H130zM168.8 499v-11.7h-12.1V499h-7.5v-29.1h7.5v10.9h12.1v-10.9h7.5V499h-7.5zM182.2 499v-29.1h7.5v22.6h11.7v6.5h-19.2zM205.2 499v-29.1h21.3v6.5h-13.8v4.5h11.4v6.6h-11.4v4.9h13.8v6.5h-21.3zM237.4 499v-22.6h-8.2v-6.5H253v6.5h-8.1V499h-7.5zM256.6 499v-29.1h7.5V499h-7.5zM267.2 484.5c0-9 6.8-15.1 15.8-15.1 7 0 10.8 4 12.7 7.8l-6.5 3.1c-1-2.3-3.4-4.2-6.2-4.2-4.8 0-8.1 3.6-8.1 8.4 0 4.8 3.4 8.4 8.1 8.4 2.8 0 5.3-1.9 6.2-4.2l6.5 3.1c-1.9 3.7-5.7 7.8-12.7 7.8-9-.1-15.8-6.2-15.8-15.1zM296.7 494.9l4-5.9c2.1 2.1 5.3 3.8 9.3 3.8 2.5 0 4.1-.9 4.1-2.3 0-3.8-16.5-.7-16.5-11.9 0-4.9 4.1-9.3 11.6-9.3 4.7 0 8.7 1.4 11.8 4.1l-4.1 5.6c-2.5-2.1-5.6-3.1-8.5-3.1-2.2 0-3.1.7-3.1 2 0 3.6 16.5.9 16.5 11.7 0 5.8-4.3 9.7-12.1 9.7-5.9.2-10-1.6-13-4.4z"
                />
              </g>
              <path
                class="st0 st1"
                d="M172.3 72.3c-3.7 0-6.7 3-6.7 6.7v53.2c0 3.7 3 6.7 6.7 6.7s6.8-3 6.8-6.7V79.1c-.1-3.7-3.1-6.8-6.8-6.8zm-18.1 9.1c-3.7 0-6.7 3-6.7 6.7V123c0 3.7 3 6.7 6.7 6.7s6.8-3 6.8-6.7V88.2c0-3.7-3.1-6.8-6.8-6.8zm90.6-9.1c-3.7 0-6.7 3-6.7 6.7v53.2c0 3.7 3 6.7 6.7 6.7s6.8-3 6.8-6.7V79.1c-.1-3.7-3.1-6.8-6.8-6.8zm18.1 9.1c-3.7 0-6.7 3-6.7 6.7V123c0 3.7 3 6.7 6.7 6.7s6.8-3 6.8-6.7V88.2c-.1-3.7-3.1-6.8-6.8-6.8zm-79.2 31h49.7V98.9h-49.7v13.5z"
              />
              <path class="st2" d="M78 43.9h259.8v125.2H78z" />
              <path
                class="st3"
                d="M207.9 394c-16-7.8-51.6-26.7-81.5-53.8-18.5 1.3-37 3-55.4 5.2 47.3 58.1 123.8 91 128.4 92.9l8.5 3.6 8.5-3.6c4.6-2 81.1-34.8 128.4-92.9-18.4-2.2-36.9-3.9-55.4-5.2-29.9 27.1-65.5 46-81.5 53.8zM381.7 68.5l-6.8-6.5c-2.7-2.5-66.5-62-167-62-100.6 0-164.3 59.4-167 62l-6.8 6.5v106.9c-12.4 2.2-23.8 4.6-34.1 7.2l24.1 146.8c52.7-12 115.8-19 183.8-19 68 0 131.1 7 183.8 19l24.1-146.8c-10.3-2.6-21.7-5-34.1-7.2V68.5zm-43.9 100.6c-38.4-4.4-82.7-6.9-129.9-6.9s-91.5 2.5-129.9 6.9v-81C94.8 75 141.8 43.9 207.9 43.9c65.5 0 112.9 31.2 129.9 44.3v80.9z"
              />
              <path
                class="st4"
                d="M2.9 135.1c-32.9 6.2-65.6 13.7-98.1 22.5 15.2 22.1 30 44.4 44.2 66.9-2.1 26.6-3.6 53.1-4.7 79.6 18.3-4.9 36.8-9.4 55.2-13.5C-8.4 254-16.4 217.5-24.4 181c8.8-15.4 17.8-30.7 27.3-45.9zM512 158.6c-32.3-9.3-64.9-17.5-97.6-24.3 9.2 15.4 18 30.8 26.4 46.4-8.7 36.4-17.3 72.8-26 109.2 18.4 4.4 36.7 9.2 55 14.5-.6-26.4-1.6-53-3.2-79.6 14.7-22.4 29.8-44.4 45.4-66.2z"
              />
              <path
                class="st5"
                d="M207.9 317.6l6.9 21.4h22.5l-18.2 13.3 7 21.4-18.2-13.3-18.2 13.3 6.9-21.4-18.2-13.3h22.5z"
              />
              <path
                class="st6"
                d="M169.2 72.6l10 17.7 19.9-4-13.8 14.9 10 17.7-18.5-8.4-13.8 14.9 2.4-20.2-18.5-8.5 20-4zM107.9 89.6l10 17.8 19.9-4-13.8 14.9 10 17.7-18.5-8.5-13.7 14.9 2.3-20.1-18.5-8.5 20-4z"
              />
              <path
                class="st2"
                d="M169.9 349.7c0 2-.5 3.5-1.4 4.6s-2.2 1.6-3.7 1.6c-1.6 0-2.8-.5-3.8-1.6s-1.4-2.6-1.4-4.6v-3.3c0-2 .5-3.5 1.4-4.6.9-1 2.2-1.6 3.8-1.6 1.6 0 2.8.5 3.8 1.6.9 1 1.4 2.6 1.4 4.6v3.3zm-3.1-3.7c0-1.2-.2-2.1-.5-2.6s-.9-.8-1.6-.8c-.7 0-1.2.3-1.6.8-.4.6-.5 1.4-.5 2.7v4c0 1.2.2 2.1.5 2.7.4.6.9.8 1.6.8.7 0 1.2-.3 1.6-.8.4-.6.5-1.4.5-2.7V346zM255.4 342.8c-1.6 1.9-2.7 3.7-3.3 5.3-.6 1.6-1 3.6-1.3 6l-.1 1.5h-3l.1-1.5c.2-2.2.7-4.3 1.5-6.2.8-1.9 1.8-3.6 3.2-5.1h-5.4l-.1 1.5h-2.3v-3.9h10.7v2.4z"
              />
              <path
                class="st7"
                d="M141.6 83.6l9.8 17.5 19.7-3.9-13.6 14.7 9.8 17.5-18.2-8.3-13.6 14.7 2.3-19.9-18.2-8.4 19.6-3.9zM270.7 83.6l-9.8 17.5-19.7-3.9 13.6 14.7-9.8 17.5 18.2-8.3 13.6 14.7-2.3-19.9 18.2-8.4-19.7-3.9z"
              />
              <path
                class="st6"
                d="M245.8 72.6l-9.9 17.7-19.9-4 13.7 14.9-9.9 17.7 18.5-8.4 13.7 14.9-2.3-20.2 18.4-8.5-19.9-4zM307.1 89.6l-9.9 17.7-19.9-4 13.7 15-9.9 17.7 18.5-8.5 13.7 14.9-2.3-20.1 18.4-8.5-19.9-4z"
              />
            </svg>
          </div>
          <div class="leaguename">
            <span class="leaguename--the">The</span><span class="leaguename--league">League</span><span class="leaguename--dotus">.us</span>
          </div>
        </a>
        <div class="clearfix"></div>
      </div>
      <div class="col right">
        <!-- User Menu -->
        <div class="user-menu-wrapper">
          <button class="user-btn" id="user-btn" aria-label="User menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </button>
          <div class="user-dropdown" id="user-dropdown">
            <div id="auth-content" class="auth-content"></div>
          </div>
        </div>

        <!-- Hamburger Menu Button -->
        <button class="hamburger-btn" id="hamburger-btn" aria-label="Toggle menu" aria-expanded="false">
          <span class="hamburger-box">
            <span class="hamburger-inner"></span>
          </span>
        </button>
      </div>
    </div>
  </div>

  <!-- Simple Navigation Menu -->
  <nav class="nav-menu" id="nav-menu">
    <div class="nav-overlay" id="nav-overlay"></div>
    <div class="nav-content">
      <button class="nav-close-btn" id="nav-close-btn" aria-label="Close menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
      <ul class="nav-links">
        <!-- TheLeague Pages -->
        <li class="nav-section-title">TheLeague Tools</li>
        <li><a href="/theleague">Asset Library</a></li>
        <li><a href="/salary">Salary Benchmarks</a></li>
        <li><a href="/salary-history">Salary History</a></li>
        <li><a href="/mvp">Salary-Adjusted MVPs</a></li>
        <li><a href="/calculator">Extension Calculator</a></li>
        <li><a href="/rosters">Roster Analysis</a></li>
        <li><hr></li>

        <!-- MFL League Links -->
        <li class="nav-section-title">League Management</li>
        <li>
          <a href={`${host}/${year}/home/${leagueId}?MODULE=MESSAGE14`}>
            <svg class="icon-banknote"><use href="/icons.svg#icon-banknote"></use></svg>
            Roster/Cap
          </a>
        </li>
        <li>
          <a href={`${host}/${year}/lineup?L=${leagueId}`}>
            <svg class="icon-submit"><use href="/icons.svg#icon-submit"></use></svg>
            Submit Lineup
          </a>
        </li>
        <li>
          <a href={`${host}/${year}/add_drop?L=${leagueId}`}>
            <svg class="icon-user-plus"><use href="/icons.svg#icon-user-plus"></use></svg>
            Add/Drop
          </a>
        </li>
        <li>
          <a href={`${host}/${year}/standings?L=${leagueId}`}>
            <svg class="icon-numberone"><use href="/icons.svg#icon-numberone"></use></svg>
            Standings
          </a>
        </li>
        <li>
          <a href={`${host}/${year}/home/${leagueId}?MODULE=MESSAGE6`}>
            <svg class="icon-scoreboard"><use href="/icons.svg#icon-scoreboard"></use></svg>
            Live Scoring
          </a>
        </li>
        <li class="playoffs">
          <a href={`${host}/${year}/options?L=${leagueId}&O=79`}>
            <svg class="icon-trophy"><use href="/icons.svg#icon-trophy"></use></svg>
            Playoffs
          </a>
        </li>
        <li class="prePlayoffs">
          <a href={`${host}/${year}/home/${leagueId}?MODULE=MESSAGE10`}>
            <svg class="icon-trophy"><use href="/icons.svg#icon-trophy"></use></svg>
            Playoffs
          </a>
        </li>
        <li><hr></li>

        <!-- External Links -->
        <li class="nav-section-title">Community</li>
        <li>
          <a href="https://theleague.us/forum/index.php">
            <svg class="icon-commenting"><use href="/icons.svg#icon-commenting"></use></svg>
            Message Board
          </a>
        </li>
        <li><a href="https://theleague.us">TheLeague.us</a></li>
        <li><a href="https://afl-fantasy.com">AFL Fantasy</a></li>
      </ul>
    </div>
  </nav>
</div>

<style>
  .theleague-header {
    background: var(--primary-content-bg-color, #ffffff);
    border-bottom: 1px solid var(--primary-content-border-color, #e2e8f0);
    box-shadow: var(--primary-content-boxshadow-size, 0 2px 6px rgba(0, 0, 0, 0.05));
    padding: 1rem 0 1.25rem;
    margin-bottom: 1.5rem;
  }

  .theleague-header .container {
    max-width: 1180px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .theleague-header .row {
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .theleague-header .col.left {
    flex: 1 1 auto;
    min-width: 0;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .theleague-header .col.right {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    margin-left: auto;
  }

  .league-link {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
  }

  .league_logo svg {
    width: 90px;
    height: 100px;
    display: block;
  }

  /* SVG Logo Colors */
  .league_logo svg .st0 {
    fill: none;
  }

  .league_logo svg .st1 {
    fill: #999999; /* Light gray for "07" text */
  }

  .league_logo svg .st2 {
    fill: #2e8743; /* Green background at top */
  }

  .league_logo svg .st3 {
    fill: #1c497c; /* Blue shield */
  }

  .league_logo svg .st4 {
    fill: #1c497c; /* Blue side elements */
  }

  .league_logo svg .st5 {
    fill: #2e8743; /* Green center star */
  }

  .league_logo svg .st6 {
    fill: #ffffff; /* White stars on green */
  }

  .league_logo svg .st7 {
    display: none; /* Hide blue stars */
  }

  .leaguename {
    font-weight: 700;
    font-size: 2.5rem;
    letter-spacing: 0.01em;
    text-transform: uppercase;
  }

  .leaguename--the {
    font-weight: 700;
    margin-right: 0.2rem;
    color: var(--primary-color, #1c497c);
  }

  .leaguename--league {
    font-weight: 700;
    color: var(--secondary-color, #2e8743);
  }

  .leaguename--dotus {
    font-weight: 700;
    color: var(--primary-color, #1c497c);
    margin-left: 0.15rem;
    text-transform: lowercase;
    font-size: 1rem;
  }

  /* User Menu Styles - Shared */
  .user-menu-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .user-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    transition: all 0.2s ease;
    border-radius: 0.5rem;
    color: var(--primary-color, #1c497c);
  }

  .user-btn svg {
    width: 24px;
    height: 24px;
    stroke: currentColor;
  }

  .user-btn:hover {
    color: var(--secondary-color, #2e8743);
  }

  .user-dropdown {
    position: absolute;
    top: calc(100% + 0.5rem);
    right: 0;
    background: white;
    border: 1px solid #ddd;
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 200px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    z-index: 1001;
    padding: 1rem;
  }

  .user-dropdown.active {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .user-dropdown-item {
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: background 0.2s ease;
    border: none;
    background: none;
    cursor: pointer;
    width: 100%;
    text-align: left;
    font-size: 0.95rem;
    color: #333;
  }

  .user-dropdown-item:hover {
    background: #f5f5f5;
    color: var(--secondary-color, #2e8743);
  }

  .user-dropdown-item:first-child {
    border-radius: 0.375rem 0.375rem 0 0;
  }

  .user-dropdown-item:last-child {
    border-radius: 0 0 0.375rem 0.375rem;
  }

  .auth-content {
    display: inline-grid;
    gap: 0.5rem;
  }

  .logout-btn {
    color: #c33;
  }

  .logout-btn:hover {
    background: #fef2f2;
    color: #dc2626;
  }

  /* Elegant Animated Hamburger Button */
  .hamburger-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.75rem;
    height: 2.75rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 998;
  }

  .hamburger-box {
    width: 24px;
    height: 18px;
    display: inline-block;
    position: relative;
  }

  .hamburger-inner {
    display: block;
    top: 50%;
    margin-top: -1px;
  }

  .hamburger-inner,
  .hamburger-inner::before,
  .hamburger-inner::after {
    width: 24px;
    height: 2px;
    background-color: var(--primary-color, #1c497c);
    border-radius: 2px;
    position: absolute;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .hamburger-inner::before,
  .hamburger-inner::after {
    content: "";
    display: block;
  }

  .hamburger-inner::before {
    top: -7px;
  }

  .hamburger-inner::after {
    bottom: -7px;
  }

  /* Hover state */
  .hamburger-btn:hover .hamburger-inner,
  .hamburger-btn:hover .hamburger-inner::before,
  .hamburger-btn:hover .hamburger-inner::after {
    background-color: var(--secondary-color, #2e8743);
  }

  /* Active state - Transform to X */
  .hamburger-btn.active .hamburger-inner {
    transform: rotate(45deg);
  }

  .hamburger-btn.active .hamburger-inner::before {
    top: 0;
    opacity: 0;
  }

  .hamburger-btn.active .hamburger-inner::after {
    bottom: 0;
    transform: rotate(-90deg);
  }

  .hamburger-btn.active:hover .hamburger-inner,
  .hamburger-btn.active:hover .hamburger-inner::before,
  .hamburger-btn.active:hover .hamburger-inner::after {
    background-color: var(--primary-link-hover-text-color, #b22222);
  }

  /* Simple Navigation Menu */
  .nav-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    z-index: 999;
    pointer-events: none;
  }

  .nav-menu.active {
    pointer-events: auto;
  }

  .nav-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .nav-menu.active .nav-overlay {
    opacity: 1;
  }

  .nav-content {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 320px;
    max-width: 85vw;
    background: var(--primary-content-bg-color, #ffffff);
    padding: 2rem 1.5rem;
    box-shadow: -4px 0 24px rgba(0, 0, 0, 0.12);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    overflow-y: auto;
  }

  .nav-menu.active .nav-content {
    transform: translateX(0);
  }

  .nav-links {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .nav-links li {
    margin-bottom: 0.5rem;
  }

  .nav-section-title {
    font-weight: 700;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--primary-link-hover-text-color, #b22222);
    margin: 1.5rem 0 0.75rem 0;
    padding: 0;
  }

  .nav-section-title:first-child {
    margin-top: 0;
  }

  .nav-links a {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #333;
    text-decoration: none;
    font-size: 1rem;
    font-weight: 500;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f5f5f5;
    transition: color 0.2s ease;
  }

  .nav-links a:hover {
    color: var(--primary-link-hover-text-color, #b22222);
  }

  .nav-links a svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
  }

  .nav-links hr {
    border: none;
    border-top: 1px solid #e5e5e5;
    margin: 1rem 0;
  }

  /* Close button */
  .nav-close-btn {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 2rem;
    height: 2rem;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.25rem;
    color: var(--primary-color, #1c497c);
    transition: color 0.2s ease;
    z-index: 1001;
  }

  .nav-close-btn:hover {
    color: var(--secondary-color, #2e8743);
  }

  .nav-close-btn svg {
    width: 100%;
    height: 100%;
  }

  /* Responsive Styles */
  @media (max-width: 960px) {
    .theleague-header {
      padding-bottom: 1rem;
    }
  }

  @media (max-width: 640px) {
    .league_logo svg {
      height: 3rem;
      width: auto;
    }

    .leaguename {
      font-size: 1.25rem;
    }

    .nav-content {
      width: 100%;
    }
  }

  @media (max-width: 360px) {
    .league_logo svg {
      height: 1.5rem;
      width: auto;
    }

    .leaguename {
      font-size: 1rem;
    }
  }
</style>

<script>
  // Simple hamburger menu
  const hamburgerBtn = document.getElementById('hamburger-btn');
  const navMenu = document.getElementById('nav-menu');
  const navOverlay = document.getElementById('nav-overlay');
  const navCloseBtn = document.getElementById('nav-close-btn');

  function toggleMenu() {
    const isActive = navMenu?.classList.toggle('active');
    hamburgerBtn?.classList.toggle('active');
    hamburgerBtn?.setAttribute('aria-expanded', isActive ? 'true' : 'false');
    document.body.style.overflow = isActive ? 'hidden' : '';
  }

  function closeMenu() {
    navMenu?.classList.remove('active');
    hamburgerBtn?.classList.remove('active');
    hamburgerBtn?.setAttribute('aria-expanded', 'false');
    document.body.style.overflow = '';
  }

  hamburgerBtn?.addEventListener('click', toggleMenu);
  navOverlay?.addEventListener('click', closeMenu);
  navCloseBtn?.addEventListener('click', closeMenu);

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && navMenu?.classList.contains('active')) {
      closeMenu();
    }
  });

  // User menu and authentication functionality
  const userBtn = document.getElementById('user-btn');
  const userDropdown = document.getElementById('user-dropdown');
  const authContent = document.getElementById('auth-content');

  function toggleUserDropdown() {
    userDropdown?.classList.toggle('active');
  }

  function closeUserDropdown() {
    userDropdown?.classList.remove('active');
  }

  // Check authentication status and update dropdown
  async function updateAuthStatus() {
    try {
      const response = await fetch('/api/auth/me', {
        credentials: 'include',
      });
      const data = await response.json();

      if (data.authenticated && data.user) {
        // User is logged in - show logout option
        authContent!.innerHTML = `
          <div class="user-dropdown-item" style="cursor: default; background: #f9fafb;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
            <span>${data.user.username}</span>
          </div>
          <button class="user-dropdown-item logout-btn" id="logout-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>Sign Out</span>
          </button>
        `;

        // Add logout listener
        const logoutBtn = document.getElementById('logout-btn');
        logoutBtn?.addEventListener('click', handleLogout);
      } else {
        // User is not logged in - show login option
        authContent!.innerHTML = `
          <button class="user-dropdown-item" id="login-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
              <polyline points="10 17 15 12 10 7"></polyline>
              <line x1="15" y1="12" x2="3" y2="12"></line>
            </svg>
            <span>Sign In</span>
          </button>
        `;

        // Add login listener
        const loginBtn = document.getElementById('login-btn');
        loginBtn?.addEventListener('click', () => {
          window.location.href = '/login';
        });
      }
    } catch (error) {
      console.error('Failed to fetch auth status:', error);
    }
  }

  async function handleLogout() {
    try {
      const response = await fetch('/api/auth/logout', {
        method: 'POST',
        credentials: 'include',
      });

      if (response.ok) {
        closeUserDropdown();
        updateAuthStatus();
      }
    } catch (error) {
      console.error('Logout failed:', error);
    }
  }

  // User dropdown menu toggle
  userBtn?.addEventListener('click', toggleUserDropdown);

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    const target = e.target as HTMLElement;
    if (!userBtn?.contains(target) && !userDropdown?.contains(target)) {
      closeUserDropdown();
    }
  });

  // Initialize auth status with a small delay to ensure DOM is ready
  setTimeout(() => {
    updateAuthStatus();
  }, 0);
</script>
