---
/**
 * PlayerDetailsModal - Displays comprehensive player information
 * Shows all available unified player model data in an organized modal
 */

import { currencyFormatter } from '@mfl/shared-utils';

export interface Props {
  /** Additional CSS classes */
  class?: string;
}

const { class: className } = Astro.props;

const formatDate = (timestamp: number | null | undefined): string => {
  if (!timestamp) return 'N/A';
  try {
    return new Date(timestamp * 1000).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    });
  } catch {
    return 'N/A';
  }
};

const getPlayerAge = (timestamp: number | null | undefined): number | null => {
  if (!timestamp) return null;
  try {
    const birthDate = new Date(timestamp * 1000);
    const today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    const monthDiff = today.getMonth() - birthDate.getMonth();
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
      age--;
    }
    return age >= 0 ? age : null;
  } catch {
    return null;
  }
};

const NFL_TEAM_NAMES: Record<string, string> = {
  ARI: 'Arizona', ATL: 'Atlanta', BAL: 'Baltimore', BUF: 'Buffalo',
  CAR: 'Carolina', CHI: 'Chicago', CIN: 'Cincinnati', CLE: 'Cleveland',
  DAL: 'Dallas', DEN: 'Denver', DET: 'Detroit', GB: 'Green Bay',
  HOU: 'Houston', IND: 'Indianapolis', JAC: 'Jacksonville', KC: 'Kansas City',
  LV: 'Las Vegas', LAC: 'Los Angeles', LAR: 'Los Angeles', MIA: 'Miami',
  MIN: 'Minnesota', NE: 'New England', NO: 'New Orleans', NYG: 'New York',
  NYJ: 'New York', PHI: 'Philadelphia', PIT: 'Pittsburgh', SEA: 'Seattle',
  SF: 'San Francisco', TB: 'Tampa Bay', TEN: 'Tennessee', WAS: 'Washington',
};
---

<div class:list={['player-details-modal', className]}>
  <div class="player-details-modal__overlay"></div>
  <div class="player-details-modal__content">
    <div class="player-details-modal__header">
      <h3 id="player-details-title">Player Profile</h3>
      <button class="player-details-modal__close" aria-label="Close" title="Close (ESC)">
        ×
      </button>
    </div>

    <div class="player-details-modal__body">
      <!-- Profile Section (Identity + Background + Headshot) -->
      <div class="player-details-section player-details-section--profile">
        <div class="profile-content">
          <!-- Top row: headshot, name, positions -->
          <div class="profile-top-row">
            <div class="profile-headshot">
              <img id="detail-headshot" src="" alt="Player headshot" />
            </div>
            <div class="player-details-field">
              <span class="player-details-field__label">Name</span>
              <span class="player-details-field__value" id="detail-name">—</span>
            </div>
            <div class="player-details-field">
              <span class="player-details-field__label">Position</span>
              <div class="position-display">
                <span class="mfl-pos" id="detail-position">—</span>
                <span class="position-separator">|</span>
                <span class="nfl-pos" id="detail-nfl-position">—</span>
              </div>
            </div>
          </div>

          <!-- Teams row: NFL Team, Jersey Number, and College -->
          <div class="profile-teams-row">
            <div class="player-details-field">
              <span class="player-details-field__label">NFL Team</span>
              <img class="player-details-nfl-logo" id="detail-nfl-team-logo" src="" alt="NFL Team Logo" />
            </div>
            <div class="player-details-field">
              <span class="player-details-field__label">Jersey #</span>
              <span class="player-details-field__value" id="detail-number">—</span>
            </div>
            <div class="player-details-field">
              <span class="player-details-field__label">College</span>
              <div class="player-details-field__value college-field">
                <img class="college-logo" id="detail-college-logo" src="" alt="" />
                <span id="detail-college">—</span>
              </div>
            </div>
          </div>

          <!-- Background row: Draft Year, Age, Birthdate -->
          <div class="profile-background-row">
            <div class="player-details-field">
              <span class="player-details-field__label">Drafted</span>
              <div class="player-details-field__value draft-display">
                <img class="draft-team-logo" id="detail-draft-team-logo" src="" alt="" />
                <span id="detail-draft">—</span>
              </div>
            </div>
            <div class="player-details-field">
              <span class="player-details-field__label">Age</span>
              <span class="player-details-field__value" id="detail-age">—</span>
            </div>
            <div class="player-details-field">
              <span class="player-details-field__label">Birthdate</span>
              <span class="player-details-field__value" id="detail-birthdate">—</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Section (moved to end, see bottom of modal) -->

      <!-- Physical Attributes Section -->
      <div class="player-details-section" id="section-physical-attributes">
        <h4 class="player-details-section__title">Physical Attributes</h4>
        <div class="player-details-grid">
          <div class="player-details-field">
            <span class="player-details-field__label">Height</span>
            <span class="player-details-field__value" id="detail-height">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Weight</span>
            <span class="player-details-field__value" id="detail-weight">—</span>
          </div>
        </div>
      </div>

      <!-- NFL Status Section -->
      <div class="player-details-section" id="section-nfl-status">
        <h4 class="player-details-section__title">NFL Status</h4>
        <div class="player-details-grid player-details-grid--three">
          <div class="player-details-field">
            <span class="player-details-field__label">Experience</span>
            <span class="player-details-field__value" id="detail-experience">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Injury Status</span>
            <span class="player-details-field__value" id="detail-injury-status">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Depth Chart</span>
            <div class="player-details-field__value depth-chart-ahead" id="detail-depth-chart-ahead">Starter</div>
          </div>
        </div>
      </div>

      <!-- Contract Section -->
      <div class="player-details-section">
        <h4 class="player-details-section__title">Contract</h4>
        <div class="player-details-grid player-details-grid--three">
          <div class="player-details-field">
            <span class="player-details-field__label">Current Salary</span>
            <span class="player-details-field__value" id="detail-salary">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Contract Years</span>
            <span class="player-details-field__value" id="detail-contract-years">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Total Remaining</span>
            <span class="player-details-field__value" id="detail-total-remaining">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Contract Type</span>
            <span class="player-details-field__value" id="detail-contract-type">—</span>
          </div>
        </div>
      </div>

      <!-- Performance Section -->
      <div class="player-details-section">
        <h4 class="player-details-section__title">Performance</h4>
        <div class="player-details-grid player-details-grid--three">
          <div class="player-details-field">
            <span class="player-details-field__label">Fantasy Points</span>
            <span class="player-details-field__value" id="detail-points">—</span>
          </div>
          <div class="player-details-field">
            <span class="player-details-field__label">Bye Week</span>
            <span class="player-details-field__value" id="detail-bye-week">—</span>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<style>
  .player-details-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    justify-content: center;
    align-items: center;
    padding: 0 1.5rem 2rem;
  }

  .player-details-modal.active {
    display: flex;
  }

  .player-details-modal__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    cursor: pointer;
  }

  .player-details-modal__content {
    position: relative;
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    width: 100%;
    max-width: 600px;
    max-height: 85vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .player-details-modal__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 1.5rem 0;

    border-bottom: 1px solid #e5e7eb;
    flex-shrink: 0;
  }

  .player-details-modal__header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 700;
    color: #111;
  }

  .player-details-modal__close {
    background: none;
    border: none;
    font-size: 1.75rem;
    color: #666;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s ease;
  }

  .player-details-modal__close:hover {
    background: #f0f0f0;
    color: #333;
  }

  .player-details-modal__body {
    overflow-y: auto;
    flex: 1;
    padding: 1.5rem;
  }

  .player-details-section {
    margin-bottom: 1.75rem;
  }

  .player-details-section:last-child {
    margin-bottom: 0;
  }

  .player-details-section__title {
    margin: 0 0 1rem 0;
    font-size: 0.95rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #475569;
  }

  .player-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
  }

  .player-details-grid--three {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }

  .player-details-field {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
    align-items: flex-start;
  }

  .player-details-field__label {
    font-size: 0.8rem;
    font-weight: 300;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.02em;
  }

  .player-details-field__value {
    font-size: 1rem;
    font-weight: 300;
    color: #1a1a1a;
    word-break: break-word;
  }

  .player-details-field__value--mono {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.9rem;
    color: #666;
  }

  .player-details-nfl-logo {
    height: 48px;
    max-width: 4rem;
    width: auto;
    object-fit: contain;
    text-align: left;
  }

  .depth-chart-ahead {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .depth-chart-ahead-item {
    padding: 0.5rem 0;
    font-size: 0.95rem;
    color: #1a1a1a;
  }

  .depth-chart-ahead-item--ahead {
    font-weight: 300;
  }

  .depth-chart-ahead-item--current {
    font-weight: 700;
  }

  .college-field {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .draft-display {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .draft-team-logo {
    height: 1rem;
    max-width: 2rem;
    width: auto;
    object-fit: contain;
    display: none;
  }

  .college-logo {
    height: 32px;
    width: auto;
    max-width: 40px;
    display: none;
    object-fit: contain;
  }

  .player-details-section--profile {
    margin-bottom: 2rem;
  }

  .profile-content {
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
  }

  .profile-top-row {
    display: grid;
    grid-template-columns: auto 1fr 1fr;
    gap: 1.5rem;
    align-items: center;
  }

  .profile-headshot {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .profile-headshot img {
    width: 100%;
    max-width: 80px;
    height: auto;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    object-fit: cover;
    aspect-ratio: 1;
  }

  .position-display {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .mfl-pos,
  .nfl-pos {
    font-weight: 600;
    color: #1a1a1a;
  }

  .position-separator {
    color: #ccc;
    font-weight: 300;
  }

  .profile-teams-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }

  .profile-background-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }

  @media (max-width: 640px) {
    .player-details-modal {
      padding: 0.5rem;
    }

    .player-details-modal__content {
      max-height: 90vh;
    }

    .player-details-modal__header {
      padding: 1rem;
    }

    .player-details-modal__body {
      padding: 1rem;
    }

    .player-details-grid {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .player-details-grid--three {
      grid-template-columns: 1fr;
    }

    .player-details-section {
      margin-bottom: 1.25rem;
    }

    .profile-top-row {
      grid-template-columns: auto 1fr;
      gap: 1rem;
    }

    .profile-headshot img {
      max-width: 60px;
    }

    .profile-teams-row,
    .profile-background-row {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  function initPlayerDetailsModal() {
    const modal = document.querySelector('.player-details-modal');
    const overlay = document.querySelector('.player-details-modal__overlay');
    const closeBtn = document.querySelector('.player-details-modal__close');

    const closeModal = () => {
      if (modal) {
        modal.classList.remove('active');
      }
    };

    if (closeBtn) {
      closeBtn.addEventListener('click', closeModal);
    }
    if (overlay) {
      overlay.addEventListener('click', closeModal);
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal && modal.classList.contains('active')) {
        closeModal();
      }
    });

    window.openPlayerDetailsModal = function(playerData) {
      const birthdateStr = playerData.birthdate
        ? new Date(playerData.birthdate * 1000).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
          })
        : 'N/A';

      let ageStr = 'N/A';
      if (playerData.birthdate) {
        const birthDate = new Date(playerData.birthdate * 1000);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        if (age >= 0) {
          ageStr = age.toString();
        }
      }

      const nflTeamNames = {
        ARI: 'Arizona', ATL: 'Atlanta', BAL: 'Baltimore', BUF: 'Buffalo',
        CAR: 'Carolina', CHI: 'Chicago', CIN: 'Cincinnati', CLE: 'Cleveland',
        DAL: 'Dallas', DEN: 'Denver', DET: 'Detroit', GB: 'Green Bay',
        HOU: 'Houston', IND: 'Indianapolis', JAC: 'Jacksonville', KC: 'Kansas City',
        LV: 'Las Vegas', LAC: 'Los Angeles', LAR: 'Los Angeles', MIA: 'Miami',
        MIN: 'Minnesota', NE: 'New England', NO: 'New Orleans', NYG: 'New York',
        NYJ: 'New York', PHI: 'Philadelphia', PIT: 'Pittsburgh', SEA: 'Seattle',
        SF: 'San Francisco', TB: 'Tampa Bay', TEN: 'Tennessee', WAS: 'Washington',
      };

      const setElementText = (id, value) => {
        const el = document.getElementById(id);
        if (el) {
          el.textContent = value || 'N/A';
        }
      };

      const setSectionVisibility = (id: string, visible: boolean) => {
        const el = document.getElementById(id);
        if (el) {
          el.style.display = visible ? '' : 'none';
        }
      };

      const formatCurrency = (value) => {
        if (value === undefined || value === null) return 'N/A';
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          maximumFractionDigits: 0,
        }).format(value);
      };

      const formatHeight = (inches: number | undefined | null) => {
        if (!inches) return 'N/A';
        const feet = Math.floor(inches / 12);
        const remainingInches = inches % 12;
        return `${feet}'${remainingInches}"`;
      };

      const formatPosition = (pos: string | undefined | null) => {
        if (!pos) return 'N/A';
        const upper = pos.toUpperCase();
        if (upper === 'SWR') return 'WR (Slot)';
        if (upper === 'LWR') return 'WR (Left)';
        if (upper === 'RWR') return 'WR (Right)';
        return upper;
      };

      const normalizeTeamCode = (team?: string | null) => {
        if (!team) return null;
        const map: Record<string, string> = {
          NEP: 'NE',
          GBP: 'GB',
          KCC: 'KC',
          SFO: 'SF',
          LVR: 'LV',
          OAK: 'LV',
          SD: 'LAC',
          STL: 'LAR',
          NOS: 'NO',
          NOR: 'NO',
          JAC: 'JAX',
          TBB: 'TB',
          FA: 'NFL',
        };
        const code = team.toUpperCase();
        return map[code] ?? code;
      };

      const formatDraft = (
        year?: number | null,
        round?: number | null,
        pick?: number | null,
        teamCode?: string | null
      ) => {
        const normalizedTeam = teamCode ? normalizeTeamCode(teamCode) : null;
        const rawTeam = teamCode ? teamCode.toUpperCase() : '';
        const isUndrafted =
          !year ||
          rawTeam === 'FA' ||
          rawTeam === 'UFA' ||
          (!round && !pick && (normalizedTeam === 'NFL' || normalizedTeam === null));
        if (isUndrafted) return 'UFA';
        const formatPick = (value?: number | null) => {
          if (value === null || value === undefined) return '??';
          const intVal = parseInt(String(value), 10);
          return Number.isFinite(intVal) ? String(intVal).padStart(2, '0') : '??';
        };
        if (year && round) return `${year} Pick ${round}.${formatPick(pick)}`;
        if (year && pick) return `${year} Pick ${formatPick(pick)}`;
        return 'UFA';
      };

      const formatContractType = (type: string | undefined | null) => {
        if (!type) return 'N/A';
        const normalized = type.toUpperCase() === 'INJURED_RESERVE' ? 'Injured Reserve' : type;
        return normalized.replace(/_/g, ' ');
      };

      const setDraftTeamLogo = (teamCode?: string | null, year?: number | null, round?: number | null, pick?: number | null) => {
        const logoEl = document.getElementById('detail-draft-team-logo') as HTMLImageElement | null;
        if (!logoEl) return;
        const normalizedTeam = teamCode ? normalizeTeamCode(teamCode) : null;
        const rawTeam = teamCode ? teamCode.toUpperCase() : '';
        const isUndrafted =
          !year ||
          rawTeam === 'FA' ||
          rawTeam === 'UFA' ||
          (!round && !pick && (normalizedTeam === 'NFL' || normalizedTeam === null));
        if (isUndrafted) {
          logoEl.src = '/assets/nfl-logos/NFL.svg';
          logoEl.alt = 'NFL logo';
          logoEl.style.display = 'inline-block';
          return;
        }
        if (!teamCode) {
          logoEl.style.display = 'none';
          logoEl.src = '';
          logoEl.alt = '';
          return;
        }
        const code = normalizedTeam || 'NFL';
        const altName = nflTeamNames[code] ?? (code === 'NFL' ? 'NFL' : code);
        logoEl.src = `/assets/nfl-logos/${code}.svg`;
        logoEl.alt = `${altName} logo`;
        logoEl.style.display = 'inline-block';
      };

      const setNflTeamLogo = (teamCode: string | undefined) => {
        const logoEl = document.getElementById('detail-nfl-team-logo') as HTMLImageElement | null;
        if (logoEl) {
          if (!teamCode || teamCode === 'FA') {
            logoEl.src = '/assets/nfl-logos/NFL.svg';
            logoEl.alt = 'Free Agent';
          } else {
            logoEl.src = `/assets/nfl-logos/${teamCode}.svg`;
            logoEl.alt = nflTeamNames[teamCode] || teamCode;
          }
        }
      };

      const setCollege = (name: string | undefined, logoUrl: string | undefined) => {
        setElementText('detail-college', name);
        const logoEl = document.getElementById('detail-college-logo') as HTMLImageElement | null;
        if (logoEl) {
          if (logoUrl) {
            logoEl.src = logoUrl;
            logoEl.alt = name ? `${name} logo` : 'College logo';
            logoEl.style.display = 'inline-block';
          } else {
            logoEl.src = '';
            logoEl.alt = '';
            logoEl.style.display = 'none';
          }
        }
      };

      const position = playerData.position;
      const isDefense = position?.toUpperCase() === 'DEF';

      setSectionVisibility('section-physical-attributes', !isDefense);
      setSectionVisibility('section-nfl-status', !isDefense);

      // Set headshot image
      const headshot = document.getElementById('detail-headshot') as HTMLImageElement | null;
      if (headshot && playerData.id) {
        const DEFAULT_HEADSHOT_URL = 'https://www49.myfantasyleague.com/player_photos_2010/no_photo_available.jpg';
        headshot.src = `https://www49.myfantasyleague.com/player_photos_2014/${playerData.id}_thumb.jpg`;
        headshot.onerror = () => {
          headshot.src = DEFAULT_HEADSHOT_URL;
        };
        headshot.alt = playerData.name || 'Player headshot';
      }

      setElementText('detail-name', playerData.name);
      setElementText('detail-position', formatPosition(position));
      setElementText('detail-nfl-position', formatPosition(playerData.depthChartPosition));

      // Conditionally show NFL position and separator for WR only
      const shouldShowDualPosition = position && ['WR', 'SWR', 'LWR', 'RWR'].includes(position.toUpperCase());
      const separatorEl = document.querySelector('.position-separator') as HTMLElement | null;
      const nflPosEl = document.getElementById('detail-nfl-position') as HTMLElement | null;
      if (separatorEl) {
        separatorEl.style.display = shouldShowDualPosition ? 'block' : 'none';
      }
      if (nflPosEl) {
        nflPosEl.style.display = shouldShowDualPosition ? 'inline' : 'none';
      }
      setNflTeamLogo(playerData.nflTeam);
      setElementText('detail-salary', formatCurrency(playerData.salary));
      setElementText('detail-contract-years', playerData.contractYears !== undefined ? playerData.contractYears : 'N/A');
      setElementText('detail-total-remaining', formatCurrency(playerData.totalRemaining));
      setElementText('detail-contract-type', formatContractType(playerData.contractType));
      setElementText('detail-points', playerData.points !== undefined ? playerData.points.toFixed(2) : 'N/A');
      setElementText('detail-bye-week', playerData.byeWeek !== null && playerData.byeWeek !== undefined ? 'Week ' + playerData.byeWeek : 'N/A');
      if (isDefense) {
        setElementText('detail-draft', 'N/A');
        setDraftTeamLogo(null, null, null, null);
      } else {
        setElementText('detail-draft', formatDraft(playerData.draftYear, playerData.draftRound, playerData.draftPick, playerData.draftTeam));
        setDraftTeamLogo(playerData.draftTeam, playerData.draftYear, playerData.draftRound, playerData.draftPick);
      }
      setCollege(playerData.college, playerData.collegeLogo);
      setElementText('detail-birthdate', birthdateStr);
      setElementText('detail-age', ageStr);
      setElementText('detail-height', formatHeight(playerData.height));
      setElementText('detail-weight', playerData.weight ? playerData.weight + ' lbs' : 'N/A');
      setElementText('detail-number', playerData.number);
      setElementText('detail-experience', playerData.experience !== undefined ? playerData.experience + ' years' : 'N/A');
      setElementText('detail-injury-status', playerData.injuryStatus || 'N/A');

      // Handle depth chart ahead
      const depthChartAheadEl = document.getElementById('detail-depth-chart-ahead');
      if (depthChartAheadEl) {
        if (playerData.depthChartAhead && Array.isArray(playerData.depthChartAhead) && playerData.depthChartAhead.length > 0) {
          const aheadHtml = playerData.depthChartAhead
            .map((p, idx) => `
              <div class="depth-chart-ahead-item depth-chart-ahead-item--ahead">
                <span>${p.name || `Player ${idx + 1}`}</span>
              </div>
            `)
            .join('');
          const currentHtml = `
            <div class="depth-chart-ahead-item depth-chart-ahead-item--current">
              <span>${playerData.name || 'Current Player'}</span>
            </div>
          `;
          depthChartAheadEl.innerHTML = aheadHtml + currentHtml;
        } else {
          depthChartAheadEl.textContent = 'Starter';
        }
      }

      if (modal) {
        modal.classList.add('active');
      }
    };
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initPlayerDetailsModal);
  } else {
    initPlayerDetailsModal();
  }
</script>
