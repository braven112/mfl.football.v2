---
/**
 * AgeDistributionChart - Horizontal bar chart showing age distribution
 * Displays player count in each age bracket
 */

import type { ChartSlice } from '../../scripts/chart-utils';

export interface Props {
  /** Array of chart slices to render */
  slices: ChartSlice[];
  /** Unique ID for the chart element */
  chartId: string;
}

const { slices = [], chartId } = Astro.props;
---

<div class="age-chart-container" data-chart-id={chartId}>
  <div class="age-chart" id={chartId} data-slices={JSON.stringify(slices)}></div>
</div>

<script>
  import { buildAgeDistributionChart } from '../../scripts/chart-utils';

  // Find all age distribution charts and render them
  document.querySelectorAll<HTMLElement>('[id^="ageChart"]').forEach((chartEl) => {
    const slicesJson = chartEl.dataset.slices;
    if (!slicesJson) return;

    try {
      const slices = JSON.parse(slicesJson);
      const total = slices.reduce((sum, slice) => sum + slice.value, 0);

      // Render the age distribution chart
      buildAgeDistributionChart(chartEl, slices, total);
    } catch (error) {
      console.error('Failed to render age distribution chart:', error);
    }
  });
</script>

<style>
  .age-chart-container {
    width: 100%;
  }

  .age-chart {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  :global(.age-bar-item) {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  :global(.age-bar-label) {
    font-size: 0.75rem;
    font-weight: 500;
    color: #111;
    display: flex;
    justify-content: space-between;
  }

  :global(.age-bar-label-range) {
    flex-shrink: 0;
  }

  :global(.age-bar-label-count) {
    text-align: right;
    flex-shrink: 0;
    color: #666;
    font-size: 0.7rem;
  }

  :global(.age-bar-fill) {
    height: 24px;
    border-radius: 4px;
    position: relative;
    transition: all 0.3s ease;
  }

  :global(.age-bar-fill:hover) {
    opacity: 0.85;
  }

  @media (max-width: 640px) {
    .age-chart {
      gap: 0.75rem;
    }

    :global(.age-bar-fill) {
      height: 20px;
    }

    :global(.age-bar-label) {
      font-size: 0.65rem;
    }
  }
</style>
