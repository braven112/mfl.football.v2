---
// Header component with hamburger menu
---

<header class="site-header">
	<div class="header-container">
		<!-- Logo and Brand -->
		<a href="/" class="brand">
			<div class="logo-placeholder">
				<!-- Placeholder for future SVG logo -->
				<svg width="40" height="40" viewBox="0 0 40 40" fill="none">
					<rect width="40" height="40" rx="8" fill="#dc2626"/>
					<text x="20" y="25" text-anchor="middle" fill="white" font-size="14" font-weight="bold">M</text>
				</svg>
			</div>
			<span class="brand-text">MFL.football</span>
		</a>

		<!-- User Menu -->
		<div class="user-menu-wrapper">
			<button class="user-btn" id="user-btn" aria-label="User menu">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
					<circle cx="12" cy="7" r="4"></circle>
				</svg>
			</button>
			<div class="user-dropdown" id="user-dropdown">
				<div id="auth-content" class="auth-content "></div>
			</div>
		</div>

		<!-- Hamburger Menu Button -->
		<button class="hamburger-btn" id="hamburger-btn" aria-label="Toggle menu">
			<span class="hamburger-line"></span>
			<span class="hamburger-line"></span>
			<span class="hamburger-line"></span>
		</button>
	</div>

	<!-- Login Modal -->
	<div class="login-modal" id="login-modal">
		<div class="login-modal-overlay" id="login-modal-overlay"></div>
		<div class="login-modal-content">
			<button class="login-modal-close" id="login-modal-close" aria-label="Close modal">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="18" y1="6" x2="6" y2="18"></line>
					<line x1="6" y1="6" x2="18" y2="18"></line>
				</svg>
			</button>
			<div class="login-modal-form">
				<div style="text-align: center; margin-bottom: 2rem;">
					<h2 style="margin: 0; font-size: 1.5rem;">Sign In</h2>
					<p style="color: #666; margin-top: 0.5rem; font-size: 0.9rem;">Sign in with your MFL account</p>
				</div>

				<form id="modal-login-form" style="display: flex; flex-direction: column; gap: 1.5rem;">
					<div id="modal-error-message" style="padding: 1rem; background-color: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33; display: none;">
						<p id="modal-error-text" style="margin: 0; font-size: 0.95rem;"></p>
					</div>

					<div style="display: flex; flex-direction: column; gap: 0.5rem;">
						<label for="modal-username" style="font-size: 0.95rem; font-weight: 500; color: #333;">Username</label>
						<input
							id="modal-username"
							type="text"
							placeholder="Enter your MFL username"
							required
							style="padding: 0.75rem; font-size: 1rem; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; box-sizing: border-box;"
						/>
					</div>

					<div style="display: flex; flex-direction: column; gap: 0.5rem;">
						<label for="modal-password" style="font-size: 0.95rem; font-weight: 500; color: #333;">Password</label>
						<input
							id="modal-password"
							type="password"
							placeholder="Enter your MFL password"
							required
							style="padding: 0.75rem; font-size: 1rem; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; box-sizing: border-box;"
						/>
					</div>

					<div style="display: flex; flex-direction: column; gap: 0.5rem;">
						<label for="modal-leagueId" style="font-size: 0.95rem; font-weight: 500; color: #333;">League ID (optional)</label>
						<input
							id="modal-leagueId"
							type="text"
							placeholder="Leave blank to use default league"
							style="padding: 0.75rem; font-size: 1rem; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; box-sizing: border-box;"
						/>
						<p style="margin: 0; font-size: 0.85rem; color: #666;">Your league ID (e.g., 13522 from the league URL)</p>
					</div>

					<button
						type="submit"
						id="modal-submit-btn"
						style="padding: 0.75rem 1.5rem; font-size: 1rem; font-weight: 600; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer;"
					>
						Sign In
					</button>

					<p style="margin: 0; font-size: 0.8rem; color: #999; text-align: center;">
						Your credentials are securely transmitted and validated only with MyFantasyLeague.com. We never store your password.
					</p>
				</form>
			</div>
		</div>
	</div>

	<!-- Navigation Menu -->
	<nav class="nav-menu" id="nav-menu">
		<div class="nav-overlay" id="nav-overlay"></div>
		<div class="nav-content">
			<button class="close-btn" id="close-btn" aria-label="Close menu">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="18" y1="6" x2="6" y2="18"></line>
					<line x1="6" y1="6" x2="18" y2="18"></line>
				</svg>
			</button>
			<ul class="nav-links">
				<li><a href="https://theleague.us">The League</a></li>
				<li><a href="https://afl-fantasy.com">AFL</a></li>
				<li><hr></li>
				<li><a href="/theleague">The League Assets</a></li>
				<li><a href="/salary">Salary Benchmarks</a></li>
				<li><a href="/salary-history">Salary Trend Data</a></li>
				<li><a href="/mvp">Salary-Adjusted MVPs</a></li>
				<li><a href="/calculator">Extension Calculator</a></li>
				<li><a href="https://www49.myfantasyleague.com/2025/home/13522?MODULE=MESSAGE14">Roster/Cap</a></li>
			</ul>
		</div>
	</nav>
</header>

<style>
	.site-header {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		background: white;
		border-bottom: 1px solid #e5e5e5;
		z-index: 1000;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	}

	.header-container {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1rem 1.5rem;
		max-width: 1200px;
		margin: 0 auto;
	}

	.brand {
		display: flex;
		align-items: center;
		gap: 0.75rem;
		text-decoration: none;
		color: black;
		transition: all 0.2s ease;
	}

	.brand:hover {
		color: #dc2626;
		text-decoration: none;
	}

	.brand:hover .brand-text {
		color: #dc2626;
	}

	.logo-placeholder svg {
		display: block;
	}

	.brand-text {
		font-size: 1.5rem;
		font-weight: bold;
		color: black;
	}

	/* User Menu Styles - Shared */
	.user-menu-wrapper {
		position: relative;
		display: flex;
		align-items: center;
		gap: 0.5rem;
		margin-right: auto;
	}

	.user-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2.5rem;
		height: 2.5rem;
		background: none;
		border: none;
		cursor: pointer;
		padding: 0;
		transition: all 0.2s ease;
		border-radius: 0.5rem;
		color: black;
	}

	.user-btn svg {
		width: 24px;
		height: 24px;
		stroke: currentColor;
	}

	.user-btn:hover {
		color: #dc2626;
	}

	.user-dropdown {
		position: absolute;
		top: calc(100% + 0.5rem);
		right: 0;
		background: white;
		border: 1px solid #ddd;
		border-radius: 0.5rem;
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
		min-width: 200px;
		opacity: 0;
		visibility: hidden;
		transform: translateY(-10px);
		transition: all 0.2s ease;
		z-index: 1001;
		padding: 1rem;
	}

	.user-dropdown.active {
		opacity: 1;
		visibility: visible;
		transform: translateY(0);
	}

	.user-dropdown-item {
		padding: 0.75rem 1rem;
		display: flex;
		align-items: center;
		gap: 0.75rem;
		text-decoration: none;
		transition: background 0.2s ease;
		border: none;
		background: none;
		cursor: pointer;
		width: 100%;
		text-align: left;
		font-size: 0.95rem;
		color: black;
	}

	.user-dropdown-item:hover {
		background: #f5f5f5;
		color: #dc2626;
	}

	.user-dropdown-item:first-child {
		border-radius: 0.375rem 0.375rem 0 0;
	}

	.user-dropdown-item:last-child {
		border-radius: 0 0 0.375rem 0.375rem;
	}

	.auth-content {
		display: inline-grid;
		gap: 0.5rem;
	}

	.logout-btn {
		color: #c33;
	}

	.logout-btn:hover {
		background: #fef2f2;
		color: #dc2626;
	}

	/* Login Modal Styles */
	.login-modal {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 2000;
		opacity: 0;
		visibility: hidden;
		transition: opacity 0.3s ease, visibility 0.3s ease;
	}

	.login-modal.active {
		opacity: 1;
		visibility: visible;
	}

	.login-modal-overlay {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.5);
	}

	.login-modal-content {
		position: relative;
		background: white;
		border-radius: 0.75rem;
		box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
		width: 90%;
		max-width: 450px;
		max-height: 90vh;
		overflow-y: auto;
	}

	.login-modal-close {
		position: absolute;
		top: 1rem;
		right: 1rem;
		background: none;
		border: none;
		cursor: pointer;
		color: #666;
		padding: 0.5rem;
		border-radius: 0.25rem;
		display: flex;
		align-items: center;
		justify-content: center;
		transition: all 0.2s ease;
		z-index: 1;
	}

	.login-modal-close:hover {
		background: #f5f5f5;
		color: #000;
	}

	.login-modal-form {
		padding: 2rem;
		padding-top: 1rem;
	}

	.hamburger-btn {
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		width: 2.5rem;
		height: 2.5rem;
		background: none;
		border: none;
		cursor: pointer;
		padding: 0;
		gap: 0.25rem;
		transition: all 0.3s ease;
		margin-left: auto;
	}

	.hamburger-line {
		width: 1.5rem;
		height: 2px;
		background: black;
		transition: all 0.3s ease;
		transform-origin: center;
	}

	.hamburger-btn:hover .hamburger-line {
		background: #dc2626;
	}

	.hamburger-btn.active .hamburger-line:nth-child(1) {
		transform: rotate(45deg) translate(0.35rem, 0.35rem);
	}

	.hamburger-btn.active .hamburger-line:nth-child(2) {
		opacity: 0;
	}

	.hamburger-btn.active .hamburger-line:nth-child(3) {
		transform: rotate(-45deg) translate(0.35rem, -0.35rem);
	}

	.nav-menu {
		position: fixed;
		top: 0;
		left: 0;
		height: 100vh;
		width: 100%;
		z-index: 999;
		visibility: hidden;
		transition: visibility 0s 0.3s;
	}

	.nav-menu.active {
		visibility: visible;
		transition: visibility 0s 0s;
	}

	.nav-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: rgba(0, 0, 0, 0.6);
		opacity: 0;
		transition: opacity 0.3s ease;
	}

	.nav-menu.active .nav-overlay {
		opacity: 1;
	}

	.nav-content {
		position: fixed;
		top: 0;
		right: 0;
		height: 100%;
		width: 300px;
		background: white;
		padding: 2rem;
		box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
		transform: translateX(100%);
		transition: transform 0.3s ease;
		z-index: 1000;
	}

	.nav-menu.active .nav-content {
		transform: translateX(0);
	}

	.close-btn {
		position: absolute;
		top: 1rem;
		right: 1rem;
		background: none;
		border: none;
		color: black;
		cursor: pointer;
		padding: 0.5rem;
		border-radius: 0.25rem;
		transition: all 0.2s ease;
		display: flex;
		align-items: center;
		justify-content: center;
	}

	.close-btn:hover {
		background: #f5f5f5;
		color: #dc2626;
	}

	.close-btn svg {
		width: 24px;
		height: 24px;
	}

	.nav-links {
		list-style: none;
		padding: 0;
		margin: 2rem 0 0 0;
	}

	.nav-links li {
		margin-bottom: 1.5rem;
	}

	.nav-links a {
		display: block;
		color: black;
		text-decoration: none;
		font-size: 1.125rem;
		font-weight: 500;
		padding: 0.75rem 0;
		border-bottom: 1px solid #f5f5f5;
		transition: color 0.2s ease;
	}

	.nav-links a:hover {
		color: #dc2626;
	}

	/* Add padding to body when header is fixed */
	:global(body) {
		padding-top: 80px;
	}

	@media (max-width: 300px) {
		.nav-content {
			width: 100%;
		}
	}
</style>

<script is:inline>
	// Hamburger menu functionality
	const hamburgerBtn = document.getElementById('hamburger-btn');
	const navMenu = document.getElementById('nav-menu');
	const navOverlay = document.getElementById('nav-overlay');
	const closeBtn = document.getElementById('close-btn');

	function toggleMenu() {
		hamburgerBtn?.classList.toggle('active');
		navMenu?.classList.toggle('active');
		document.body.style.overflow = navMenu?.classList.contains('active') ? 'hidden' : '';
	}

	function closeMenu() {
		hamburgerBtn?.classList.remove('active');
		navMenu?.classList.remove('active');
		document.body.style.overflow = '';
	}

	hamburgerBtn?.addEventListener('click', toggleMenu);
	navOverlay?.addEventListener('click', closeMenu);
	closeBtn?.addEventListener('click', closeMenu);

	// Close menu on escape key
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && navMenu?.classList.contains('active')) {
			closeMenu();
		}
	});

	// Close menu on window resize (for responsive behavior)
	window.addEventListener('resize', () => {
		if (window.innerWidth > 768 && navMenu?.classList.contains('active')) {
			closeMenu();
		}
	});

	// User menu and authentication functionality
	const userBtn = document.getElementById('user-btn');
	const userDropdown = document.getElementById('user-dropdown');
	const authContent = document.getElementById('auth-content');
	const loginModal = document.getElementById('login-modal');
	const loginModalOverlay = document.getElementById('login-modal-overlay');
	const loginModalClose = document.getElementById('login-modal-close');

	function toggleUserDropdown() {
		userDropdown?.classList.toggle('active');
	}

	function closeUserDropdown() {
		userDropdown?.classList.remove('active');
	}

	function openLoginModal() {
		loginModal?.classList.add('active');
		document.body.style.overflow = 'hidden';
		closeUserDropdown();
	}

	function closeLoginModal() {
		loginModal?.classList.remove('active');
		document.body.style.overflow = '';
	}

	// Check authentication status and update dropdown
	async function updateAuthStatus() {
		try {
			const response = await fetch('/api/auth/me', {
				credentials: 'include',
			});
			const data = await response.json();

			if (data.authenticated && data.user) {
				// User is logged in - show logout option
				authContent!.innerHTML = `
					<div class="user-dropdown-item" style="cursor: default; background: #f9fafb;">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
							<circle cx="12" cy="7" r="4"></circle>
						</svg>
						<span>${data.user.username}</span>
					</div>
					<button class="user-dropdown-item logout-btn" id="logout-btn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
							<polyline points="16 17 21 12 16 7"></polyline>
							<line x1="21" y1="12" x2="9" y2="12"></line>
						</svg>
						<span>Sign Out</span>
					</button>
				`;

				// Add logout listener
				const logoutBtn = document.getElementById('logout-btn');
				logoutBtn?.addEventListener('click', handleLogout);
			} else {
				// User is not logged in - show login option
				authContent!.innerHTML = `
					<button class="user-dropdown-item" id="login-btn">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
							<polyline points="10 17 15 12 10 7"></polyline>
							<line x1="15" y1="12" x2="3" y2="12"></line>
						</svg>
						<span>Sign In</span>
					</button>
				`;

				// Add login listener
				const loginBtn = document.getElementById('login-btn');
				loginBtn?.addEventListener('click', openLoginModal);
			}
		} catch (error) {
			console.error('Failed to fetch auth status:', error);
		}
	}

	async function handleLogout() {
		try {
			const response = await fetch('/api/auth/logout', {
				method: 'POST',
				credentials: 'include',
			});

			if (response.ok) {
				closeUserDropdown();
				updateAuthStatus();
			}
		} catch (error) {
			console.error('Logout failed:', error);
		}
	}

	// User dropdown menu toggle
	userBtn?.addEventListener('click', toggleUserDropdown);

	// Close dropdown when clicking outside
	document.addEventListener('click', (e) => {
		const target = e.target as HTMLElement;
		if (!userBtn?.contains(target) && !userDropdown?.contains(target)) {
			closeUserDropdown();
		}
	});

	// Login modal controls
	loginModalOverlay?.addEventListener('click', closeLoginModal);
	loginModalClose?.addEventListener('click', closeLoginModal);

	// Close modal on escape
	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && loginModal?.classList.contains('active')) {
			closeLoginModal();
		}
	});

	// Handle login form submission in modal
	const modalLoginForm = document.getElementById('modal-login-form') as HTMLFormElement;
	const modalSubmitBtn = document.getElementById('modal-submit-btn') as HTMLButtonElement;
	const modalErrorMsg = document.getElementById('modal-error-message') as HTMLDivElement;
	const modalErrorText = document.getElementById('modal-error-text') as HTMLParagraphElement;

	modalLoginForm?.addEventListener('submit', async (e: Event) => {
		e.preventDefault();
		modalErrorMsg.style.display = 'none';
		modalSubmitBtn.disabled = true;
		modalSubmitBtn.textContent = 'Signing in...';

		try {
			const username = (document.getElementById('modal-username') as HTMLInputElement).value;
			const password = (document.getElementById('modal-password') as HTMLInputElement).value;
			const leagueId = (document.getElementById('modal-leagueId') as HTMLInputElement).value;

			const response = await fetch('/api/auth/login', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				credentials: 'include',
				body: JSON.stringify({
					username,
					password,
					leagueId: leagueId || undefined,
				}),
			});

			const data = await response.json();

			if (!response.ok) {
				throw new Error(data.message || 'Login failed');
			}

			closeLoginModal();
			updateAuthStatus();
			modalLoginForm.reset();
			modalSubmitBtn.textContent = 'Sign In';
		} catch (error) {
			const msg = error instanceof Error ? error.message : 'Login failed';
			modalErrorText.textContent = msg;
			modalErrorMsg.style.display = 'block';
			modalSubmitBtn.disabled = false;
			modalSubmitBtn.textContent = 'Sign In';
		}
	});

	// Initialize auth status with a small delay to ensure DOM is ready
	setTimeout(() => {
		updateAuthStatus();
	}, 0);
</script>
